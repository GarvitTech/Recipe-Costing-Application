<Page x:Class="RecipeCostingApp.Views.ItemMasterPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      Title="Item Master">

    <Grid Margin="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,20">
            <Label Content="ðŸ“¦ Item Master" Style="{StaticResource SectionHeader}" FontSize="24"/>
            <TextBlock Text="Manage your ingredient database" VerticalAlignment="Bottom" 
                      Margin="10,0,0,8" Foreground="Gray"/>
        </StackPanel>

        <!-- Input Form -->
        <Border Grid.Row="1" Background="{StaticResource SurfaceBrush}" 
                BorderBrush="{StaticResource BorderBrush}" BorderThickness="1" 
                CornerRadius="5" Padding="20" Margin="0,0,0,20">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="200"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="200"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="150"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <!-- Row 1 -->
                <Label Grid.Row="0" Grid.Column="0" Content="Name:" Style="{StaticResource FieldLabel}"/>
                <TextBox Grid.Row="0" Grid.Column="1" Name="TxtName" Style="{StaticResource InputTextBox}" Margin="0,0,20,0"/>

                <Label Grid.Row="0" Grid.Column="2" Content="Category:" Style="{StaticResource FieldLabel}"/>
                <ComboBox Grid.Row="0" Grid.Column="3" Name="CmbCategory" Style="{StaticResource InputComboBox}" 
                         IsEditable="True" Margin="0,0,20,0"/>

                <Label Grid.Row="0" Grid.Column="4" Content="Unit:" Style="{StaticResource FieldLabel}"/>
                <ComboBox Grid.Row="0" Grid.Column="5" Name="CmbUnit" Style="{StaticResource InputComboBox}">
                    <ComboBoxItem Content="g"/>
                    <ComboBoxItem Content="ml"/>
                    <ComboBoxItem Content="Pc"/>
                    <ComboBoxItem Content="Kg"/>
                    <ComboBoxItem Content="Liter"/>
                </ComboBox>

                <!-- Row 2 -->
                <Label Grid.Row="1" Grid.Column="0" Content="Purchase Unit:" Style="{StaticResource FieldLabel}" Margin="0,10,10,0"/>
                <TextBox Grid.Row="1" Grid.Column="1" Name="TxtPurchaseUnit" Style="{StaticResource InputTextBox}" 
                        Margin="0,10,20,0" Text="1000"/>

                <Label Grid.Row="1" Grid.Column="2" Content="Price:" Style="{StaticResource FieldLabel}" Margin="0,10,10,0"/>
                <TextBox Grid.Row="1" Grid.Column="3" Name="TxtPrice" Style="{StaticResource InputTextBox}" 
                        Margin="0,10,20,0"/>

                <Label Grid.Row="1" Grid.Column="4" Content="Waste %:" Style="{StaticResource FieldLabel}" Margin="0,10,10,0"/>
                <TextBox Grid.Row="1" Grid.Column="5" Name="TxtWastePercentage" Style="{StaticResource InputTextBox}" 
                        Margin="0,10,0,0" Text="0"/>

                <!-- Row 3 - Calculated Fields -->
                <Label Grid.Row="2" Grid.Column="0" Content="Unit Cost:" Style="{StaticResource FieldLabel}" Margin="0,10,10,0"/>
                <TextBox Grid.Row="2" Grid.Column="1" Name="TxtUnitCost" Style="{StaticResource CalculatedTextBox}" 
                        Margin="0,10,20,0"/>

                <Label Grid.Row="2" Grid.Column="2" Content="Yield %:" Style="{StaticResource FieldLabel}" Margin="0,10,10,0"/>
                <TextBox Grid.Row="2" Grid.Column="3" Name="TxtYield" Style="{StaticResource CalculatedTextBox}" 
                        Margin="0,10,20,0"/>

                <!-- Buttons -->
                <StackPanel Grid.Row="2" Grid.Column="6" Orientation="Horizontal" 
                           HorizontalAlignment="Right" Margin="0,10,0,0">
                    <Button Name="BtnSave" Content="ðŸ’¾ Save" Style="{StaticResource PrimaryButton}" 
                           Margin="0,0,10,0" Click="BtnSave_Click"/>
                    <Button Name="BtnClear" Content="ðŸ—‘ï¸ Clear" Style="{StaticResource PrimaryButton}" 
                           Click="BtnClear_Click"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- Data Grid -->
        <Border Grid.Row="2" Background="{StaticResource SurfaceBrush}" 
                BorderBrush="{StaticResource BorderBrush}" BorderThickness="1" CornerRadius="5">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <!-- Search Bar -->
                <Border Grid.Row="0" Background="{StaticResource BackgroundBrush}" 
                        BorderBrush="{StaticResource BorderBrush}" BorderThickness="0,0,0,1" Padding="15,10">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="300"/>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        
                        <Label Grid.Column="0" Content="ðŸ” Search:" Style="{StaticResource FieldLabel}"/>
                        <TextBox Grid.Column="1" Name="TxtSearch" Style="{StaticResource InputTextBox}" 
                                TextChanged="TxtSearch_TextChanged" 
                                ToolTip="Search by name or category"/>
                        <Button Grid.Column="2" Name="BtnRefresh" Content="ðŸ”„ Refresh" Style="{StaticResource PrimaryButton}" 
                               Margin="20,0,0,0" Click="BtnRefresh_Click"/>
                        
                        <!-- Import Buttons -->
                        <StackPanel Grid.Column="4" Orientation="Horizontal">
                            <Button Name="BtnImportExcel" Content="ðŸ“Š Import CSV" Style="{StaticResource PrimaryButton}" 
                                   Margin="10,0,0,0" Click="BtnImportExcel_Click" 
                                   ToolTip="Import ingredients from CSV file (.csv)"/>
                        </StackPanel>
                    </Grid>
                </Border>

                <!-- Ingredients Grid -->
                <DataGrid Grid.Row="1" Name="DgIngredients" Style="{StaticResource ModernDataGrid}" 
                         SelectionChanged="DgIngredients_SelectionChanged">
                    <DataGrid.Columns>
                        <DataGridTextColumn Header="ID" Binding="{Binding Id}" Width="50" IsReadOnly="True"/>
                        <DataGridTextColumn Header="Name" Binding="{Binding Name}" Width="200"/>
                        <DataGridTextColumn Header="Category" Binding="{Binding Category}" Width="150"/>
                        <DataGridTextColumn Header="Unit" Binding="{Binding Unit}" Width="80"/>
                        <DataGridTextColumn Header="Purchase Unit" Binding="{Binding PurchaseUnit}" Width="100"/>
                        <DataGridTextColumn Header="Price" Binding="{Binding Price, StringFormat=C2}" Width="100"/>
                        <DataGridTextColumn Header="Waste %" Binding="{Binding WastePercentage, StringFormat=F1}" Width="80"/>
                        <DataGridTextColumn Header="Yield %" Binding="{Binding Yield, StringFormat=F1}" Width="80"/>
                        <DataGridTextColumn Header="Unit Cost" Binding="{Binding UnitCost, StringFormat=C4}" Width="100"/>
                        <DataGridTemplateColumn Header="Actions" Width="120">
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <StackPanel Orientation="Horizontal">
                                        <Button Content="âœï¸" ToolTip="Edit" Margin="2" Padding="5,2" 
                                               Click="BtnEdit_Click" Tag="{Binding}"/>
                                        <Button Content="ðŸ—‘ï¸" ToolTip="Delete" Margin="2" Padding="5,2" 
                                               Click="BtnDelete_Click" Tag="{Binding}"/>
                                    </StackPanel>
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                        </DataGridTemplateColumn>
                    </DataGrid.Columns>
                </DataGrid>
            </Grid>
        </Border>
    </Grid>
</Page>